{"version":3,"sources":["public/src/modules/taskbar.js"],"names":["define","Benchpress","taskbar","init","self","this","parse","html","$","tasklist","find","document","body","append","on","$btn","module","attr","uuid","require","hasClass","minimizeAll","load","toggleNew","app","alternatingTitle","removeClass","addClass","minimize","discard","btnEl","remove","update","push","options","element","data","window","trigger","length","createTaskbar","get","items","map","idx","el","toggleClass","state","silent","updateActive","tasks","filter","isActive","taskBtn","removeAttr","title","text","taskbarEl","className","icon","image","data-module","data-uuid","undefined","updateTitle","newTitle"],"mappings":"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","file":"public/src/modules/taskbar.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('taskbar', ['benchpress'], function (Benchpress) {\r\n\tvar taskbar = {};\r\n\r\n\ttaskbar.init = function () {\r\n\t\tvar self = this;\r\n\r\n\t\tBenchpress.parse('modules/taskbar', {}, function (html) {\r\n\t\t\tself.taskbar = $(html);\r\n\t\t\tself.tasklist = self.taskbar.find('ul');\r\n\t\t\t$(document.body).append(self.taskbar);\r\n\r\n\t\t\tself.taskbar.on('click', 'li', function () {\r\n\t\t\t\tvar\t$btn = $(this);\r\n\t\t\t\tvar module = $btn.attr('data-module');\r\n\t\t\t\tvar uuid = $btn.attr('data-uuid');\r\n\r\n\t\t\t\trequire([module], function (module) {\r\n\t\t\t\t\tif (!$btn.hasClass('active')) {\r\n\t\t\t\t\t\tminimizeAll();\r\n\t\t\t\t\t\tmodule.load(uuid);\r\n\t\t\t\t\t\ttaskbar.toggleNew(uuid, false);\r\n\t\t\t\t\t\tapp.alternatingTitle('');\r\n\r\n\t\t\t\t\t\ttaskbar.tasklist.removeClass('active');\r\n\t\t\t\t\t\t$btn.addClass('active');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmodule.minimize(uuid);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\ttaskbar.discard = function (module, uuid) {\r\n\t\tvar btnEl = taskbar.tasklist.find('[data-module=\"' + module + '\"][data-uuid=\"' + uuid + '\"]');\r\n\t\tbtnEl.remove();\r\n\r\n\t\tupdate();\r\n\t};\r\n\r\n\ttaskbar.push = function (module, uuid, options) {\r\n\t\tvar element = taskbar.tasklist.find('li[data-uuid=\"' + uuid + '\"]');\r\n\r\n\t\tvar data = {\r\n\t\t\tmodule: module,\r\n\t\t\tuuid: uuid,\r\n\t\t\toptions: options,\r\n\t\t\telement: element,\r\n\t\t};\r\n\r\n\t\t$(window).trigger('filter:taskbar.push', data);\r\n\r\n\t\tif (!element.length && data.module) {\r\n\t\t\tcreateTaskbar(data);\r\n\t\t}\r\n\t};\r\n\r\n\ttaskbar.get = function (module) {\r\n\t\tvar items = $('[data-module=\"' + module + '\"]').map(function (idx, el) {\r\n\t\t\treturn $(el).data();\r\n\t\t});\r\n\r\n\t\treturn items;\r\n\t};\r\n\r\n\ttaskbar.minimize = function (module, uuid) {\r\n\t\tvar btnEl = taskbar.tasklist.find('[data-module=\"' + module + '\"][data-uuid=\"' + uuid + '\"]');\r\n\t\tbtnEl.toggleClass('active', false);\r\n\t};\r\n\r\n\ttaskbar.toggleNew = function (uuid, state, silent) {\r\n\t\tvar btnEl = taskbar.tasklist.find('[data-uuid=\"' + uuid + '\"]');\r\n\t\tbtnEl.toggleClass('new', state);\r\n\r\n\t\tif (!silent) {\r\n\t\t\t$(window).trigger('action:taskbar.toggleNew', uuid);\r\n\t\t}\r\n\t};\r\n\r\n\ttaskbar.updateActive = function (uuid) {\r\n\t\tvar\ttasks = taskbar.tasklist.find('li');\r\n\t\ttasks.removeClass('active');\r\n\t\ttasks.filter('[data-uuid=\"' + uuid + '\"]').addClass('active');\r\n\r\n\t\t$('[data-uuid]:not([data-module])').toggleClass('modal-unfocused', true);\r\n\t\t$('[data-uuid=\"' + uuid + '\"]:not([data-module])').toggleClass('modal-unfocused', false);\r\n\t};\r\n\r\n\ttaskbar.isActive = function (uuid) {\r\n\t\tvar taskBtn = taskbar.tasklist.find('li[data-uuid=\"' + uuid + '\"]');\r\n\t\treturn taskBtn.hasClass('active');\r\n\t};\r\n\r\n\tfunction update() {\r\n\t\tvar\ttasks = taskbar.tasklist.find('li');\r\n\r\n\t\tif (tasks.length > 0) {\r\n\t\t\ttaskbar.taskbar.attr('data-active', '1');\r\n\t\t} else {\r\n\t\t\ttaskbar.taskbar.removeAttr('data-active');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction minimizeAll() {\r\n\t\ttaskbar.tasklist.find('.active').removeClass('active');\r\n\t}\r\n\r\n\tfunction createTaskbar(data) {\r\n\t\tvar title = $('<div></div>').text(data.options.title || 'NodeBB Task').html();\r\n\r\n\t\tvar\ttaskbarEl = $('<li />')\r\n\t\t\t.addClass(data.options.className)\r\n\t\t\t.html('<a href=\"#\">' +\r\n\t\t\t\t(data.options.icon ? '<i class=\"fa ' + data.options.icon + '\"></i> ' : '') +\r\n\t\t\t\t(data.options.image ? '<img src=\"' + data.options.image + '\"/> ' : '') +\r\n\t\t\t\t'<span component=\"taskbar/title\">' + title + '</span>' +\r\n\t\t\t\t'</a>')\r\n\t\t\t.attr({\r\n\t\t\t\t'data-module': data.module,\r\n\t\t\t\t'data-uuid': data.uuid,\r\n\t\t\t})\r\n\t\t\t.addClass(data.options.state !== undefined ? data.options.state : 'active');\r\n\r\n\t\tif (!data.options.state || data.options.state === 'active') {\r\n\t\t\tminimizeAll();\r\n\t\t}\r\n\r\n\t\ttaskbar.tasklist.append(taskbarEl);\r\n\t\tupdate();\r\n\r\n\t\tdata.element = taskbarEl;\r\n\r\n\t\ttaskbarEl.data(data);\r\n\t\t$(window).trigger('action:taskbar.pushed', data);\r\n\t}\r\n\r\n\ttaskbar.updateTitle = function (module, uuid, newTitle) {\r\n\t\ttaskbar.tasklist.find('[data-module=\"' + module + '\"][data-uuid=\"' + uuid + '\"] [component=\"taskbar/title\"]').text(newTitle);\r\n\t};\r\n\r\n\treturn taskbar;\r\n});\r\n"]}